generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["auth"]
}

enum Provider {
  CREDENTIALS
  GOOGLE
  CI

  @@schema("auth")
}

enum StatusEnum {
  ACTIVE
  INACTIVE
  BLOCKED
  SUSPENDED
  DEACTIVATED
  PENDING_VERIFICATION
  PASSWORD_EXPIRED
  LOCKED
  DELETED
  EXTERNAL
  ARCHIVED

  @@schema("auth")
}

model User {
  id          String        @id @default(uuid())
  email       String?       @unique
  full_name   String?
  cel         String?
  ci          String?       @unique
  photo       String?
  statusId    String?
  Status      StatusEnum    @default(ACTIVE)
  authMethods AuthMethods[]
  created_at  DateTime      @default(now())
  updated_at  DateTime      @updatedAt
  roleId      String?
  Role        Role?         @relation(fields: [roleId], references: [id])

  @@map("users")
  @@schema("auth")
}

model AuthMethods {
  id         String   @id @default(uuid())
  userId     String   @unique
  provider   Provider
  password   String?
  google_id  String?  @unique
  ci_number  String?  @unique
  extra_data Json?
  user       User     @relation(fields: [userId], references: [id])
  created_at DateTime @default(now())

  @@unique([userId, provider])
  @@schema("auth")
}

model Role {
  id             String           @id @default(uuid())
  name           String           @unique
  users          User[]
  RolePermission RolePermission[]

  @@index([name], name: "idx_roles_name")
  @@map("roles")
  @@schema("auth")
}

model Permissons {
  id             String           @id @default(uuid())
  name           String           @unique
  description    String?
  RolePermission RolePermission[]

  @@index([name], name: "idx_permissons_name")
  @@map("permissons")
  @@schema("auth")
}

model RolePermission {
  roleId       String
  permissionId String

  role       Role       @relation(fields: [roleId], references: [id])
  permission Permissons @relation(fields: [permissionId], references: [id])

  @@id([roleId, permissionId])
  @@map("role_permissions")
  @@schema("auth")
}
